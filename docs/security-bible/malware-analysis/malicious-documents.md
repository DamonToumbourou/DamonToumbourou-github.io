---
layout: default
title: Malicious Documents
parent: Malware Analysis
grand_parent: Security Bible
nav_order: 1
---

# Malicious Documents
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

### General Approach to Document Analysis
1. Examine the document for anomalies, such as risky tags, scripts, and embedded artifacts.
2. Locate embedded code, such as shellcode, macros, JavaScript, or other suspicious objects.
3. Extract suspicious code or objects from the file.
4. If relevant, deobfuscate and examine macros, JavaScript, or other embedded code.
5. If relevant, emulate, disassemble and/or debug shellcode that you extracted from the document.
6. Understand the next steps in the infection chain. 

### Microsoft Office Format Notes
* Binary Microsoft Office document files (.doc, .xls, etc.) use the OLE2 (a.k.a. Structured Storage) format.
* SRP streams in OLE2 documents sometimes store a cached version of earlier VBA macro code. 
* OOXML document files (.docx, .xlsm, etc.)supported by Microsoft Office are compressed zip archives.
* VBA macros in OOXML documents are stored inside an OLE2 binary file, which is within the zip archive.
* Excel supports XLM macros that are embedded as formulas in sheets without the OLE2 binary file.
* RTF documents donâ€™t support macros but can contain malicious embedded files and objects.


### Useful MS Office File Analysis Commands
``` yaml
zipdump.py:
$ file.pptx
Examine contents of OOXML file file.pptx.

zipdump.py:
$ file.pptx -s 3 -d
Extract file with index 3 from file.pptx to STDOUT.

```

### Risky PDF Keywords
* /OpenAction and /AA specify the script or action to run automatically.
* /JavaScript, /JS, /AcroForm, and /XFA can specify JavaScript to run.
* /URI accesses a URL, perhaps for phishing.
* /SubmitForm and /GoToR can send data to URL.
* /ObjStm can hide objects inside an object stream.
* /XObject can embed an image for phishing.
* Be mindful of obfuscation with hex codes, such as/JavaScript vs. /J#61vaScript. (See examples.)


Source: https://zeltser.com/media/docs/analyzing-malicious-document-files.pdf

---